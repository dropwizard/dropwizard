
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Dropwizard Validation | Dropwizard</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css"/>
    <link rel="stylesheet" href="../_static/dropwizard.css" type="text/css"/>
    <link rel="top" title="Dropwizard" href="../index.html"/>
    <link rel="up" title="User Manual" href="index.html"/>
    <link rel="next" title="Dropwizard Views" href="views.html"/>
    <link rel="prev" title="Dropwizard Forms" href="forms.html"/>
    <style lang="text/css">
        #top-bar, #top-bar small, #top-bar a {
            text-shadow: 0px -1px 0px #182127;
            color: #ffffff;
        }

        #top-bar {
            background-color: #363F45;
            background-image: -moz-linear-gradient(top, #545d63, #182127);
            background-image: -ms-linear-gradient(top, #545d63, #182127);
            background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#545d63), to(#182127));
            background-image: -webkit-linear-gradient(top, #545d63, #182127);
            background-image: -o-linear-gradient(top, #545d63, #182127);
            background-image: linear-gradient(top, #545d63, #182127);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr = '#545d63', endColorstr = '#182127', GradientType = 0);
            -webkit-border-radius: 0;
            -moz-border-radius: 0;
            border-radius: 0;
        }


        .hero-unit {
            background-image: url("../_static/dropwizard-hat.png") !important;
            background-repeat: no-repeat !important;
            background-position: 30px 50px;
        }

        .hero-unit div.section {
            padding-left: 150px !important;
        }
    </style>
</head>
<body>
    <a href="https://github.com/dropwizard/dropwizard">
        <img style="position: absolute; top: 0; right: 0; border: 0;"
             src="https://s3.amazonaws.com/github/ribbons/forkme_right_orange_ff7600.png"
             alt="Fork me on GitHub"></a>
    <div class="navbar">
        <div class="navbar-inner container-fluid" id="top-bar">
            <header class="row-fluid">
                <h1 class="span12" id="title"><img class="logo" src="../_static/dropwizard-logo.png" alt="Logo"/>
                    <a href="../index.html">Dropwizard</a>
                    <small>Production-ready, out of the box.</small>
                </h1>
            </header>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <div class="span3" id="sidebar">
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../getting-started.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">User Manual</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="core.html">Dropwizard Core</a></li>
<li class="toctree-l2"><a class="reference internal" href="client.html">Dropwizard Client</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbi.html">Dropwizard JDBI</a></li>
<li class="toctree-l2"><a class="reference internal" href="jdbi3.html">Dropwizard JDBI3</a></li>
<li class="toctree-l2"><a class="reference internal" href="migrations.html">Dropwizard Migrations</a></li>
<li class="toctree-l2"><a class="reference internal" href="hibernate.html">Dropwizard Hibernate</a></li>
<li class="toctree-l2"><a class="reference internal" href="auth.html">Dropwizard Authentication</a></li>
<li class="toctree-l2"><a class="reference internal" href="forms.html">Dropwizard Forms</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Dropwizard Validation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#validations">Validations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#constraining-entities">Constraining Entities</a></li>
<li class="toctree-l4"><a class="reference internal" href="#optional-t-constraints"><code class="docutils literal"><span class="pre">Optional&lt;T&gt;</span></code> Constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#enum-constraints">Enum Constraints</a></li>
<li class="toctree-l4"><a class="reference internal" href="#return-value-validations">Return Value Validations</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#limitations">Limitations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#annotations">Annotations</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#validating-grouped-constraints-with-validated">Validating Grouped Constraints with <code class="docutils literal"><span class="pre">&#64;Validated</span></code></a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#extending">Extending</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="views.html">Dropwizard Views</a></li>
<li class="toctree-l2"><a class="reference internal" href="scala.html">Dropwizard &amp; Scala</a></li>
<li class="toctree-l2"><a class="reference internal" href="testing.html">Testing Dropwizard</a></li>
<li class="toctree-l2"><a class="reference internal" href="example.html">Dropwizard Example, Step by Step</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuration.html">Dropwizard Configuration Reference</a></li>
<li class="toctree-l2"><a class="reference internal" href="internals.html">Dropwizard Internals</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../about/javadoc.html">Javadoc</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/index.html">About Dropwizard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../about/docs-index.html">Other Versions</a></li>
</ul>

                <hr/>
                <ul>
                    <li><a href="https://dropwizard.github.io/dropwizard/1.3.0">Maven Site</a></li>
                    <li><a href="https://groups.google.com/forum/#!forum/dropwizard-user">User Mailing List</a></li>
                    <li><a href="https://groups.google.com/forum/#!forum/dropwizard-dev">Developer Mailing List</a></li>
                </ul>
            </div>
            <div class="span9" id="body">
                
  <div class="section" id="dropwizard-validation">
<span id="man-validation"></span><h1>Dropwizard Validation</h1>
<p class="rubric">Dropwizard comes with a host of validation tools out of the box to allow endpoints to return meaningful error messages when constraints are violated. <a class="reference external" href="http://hibernate.org/validator/">Hibernate Validator</a> is packaged with Dropwizard, so what can be done in Hibernate Validator, can be done with Dropwizard.</p>
<div class="section" id="validations">
<span id="man-validation-validations"></span><h2>Validations</h2>
<p>Almost anything can be validated on resource endpoints. To give a quick example, the following
endpoint doesn’t allow a null or empty <code class="docutils literal"><span class="pre">name</span></code> query parameter.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@GET</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">find</span><span class="o">(</span><span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="nd">@NotEmpty</span> <span class="n">String</span> <span class="n">arg</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If a client sends an empty or nonexistent name query param, Dropwizard will respond with a <code class="docutils literal"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></code>
code with the error: <code class="docutils literal"><span class="pre">query</span> <span class="pre">param</span> <span class="pre">name</span> <span class="pre">may</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">empty</span></code>.</p>
<p>Additionally, annotations such as <code class="docutils literal"><span class="pre">HeaderParam</span></code>, <code class="docutils literal"><span class="pre">CookieParam</span></code>, <code class="docutils literal"><span class="pre">FormParam</span></code>, etc, can be
constrained with violations giving descriptive errors and 400 status codes.</p>
<div class="section" id="constraining-entities">
<span id="man-validation-validations-constraining-entities"></span><h3>Constraining Entities</h3>
<p>If we’re accepting client-provided <code class="docutils literal"><span class="pre">Person</span></code>, we probably want to ensure that the <code class="docutils literal"><span class="pre">name</span></code> field of
the object isn’t <code class="docutils literal"><span class="pre">null</span></code> or blank in the request. We can do this as follows:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>

    <span class="nd">@NotEmpty</span> <span class="c1">// ensure that name isn&#39;t null or blank</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@JsonCreator</span>
    <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Then, in our resource class, we can add the <code class="docutils literal"><span class="pre">&#64;Valid</span></code> annotation to the <code class="docutils literal"><span class="pre">Person</span></code> annotation:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@PUT</span>
<span class="kd">public</span> <span class="n">Person</span> <span class="nf">replace</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nd">@Valid</span> <span class="n">Person</span> <span class="n">person</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If the name field is missing, Dropwizard will return a <code class="docutils literal"><span class="pre">422</span> <span class="pre">Unprocessable</span> <span class="pre">Entity</span></code> response
detailing the validation errors: <code class="docutils literal"><span class="pre">name</span> <span class="pre">may</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">empty</span></code></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You don’t need <code class="docutils literal"><span class="pre">&#64;Valid</span></code> when the type you are validating can be validated directly (<code class="docutils literal"><span class="pre">int</span></code>,
<code class="docutils literal"><span class="pre">String</span></code>, <code class="docutils literal"><span class="pre">Integer</span></code>). If a class has fields that need validating, then instances of the
class must be marked <code class="docutils literal"><span class="pre">&#64;Valid</span></code>. For more information, see the Hibernate Validator documentation
on <a class="reference external" href="https://docs.jboss.org/hibernate/validator/5.4/reference/en-US/html_single/#section-object-graph-validation">Object graphs</a> and <a class="reference external" href="https://docs.jboss.org/hibernate/validator/5.4/reference/en-US/html_single/#example-cascaded-validation">Cascaded validation</a>.</p>
</div>
<p>Since our entity is also annotated with <code class="docutils literal"><span class="pre">&#64;NotNull</span></code>, Dropwizard will also guard against <code class="docutils literal"><span class="pre">null</span></code>
input with a response stating that the body must not be null.</p>
</div>
<div class="section" id="optional-t-constraints">
<span id="man-validation-validations-optional-constraints"></span><h3><code class="docutils literal"><span class="pre">Optional&lt;T&gt;</span></code> Constraints</h3>
<p>If an entity, field, or parameter is not required, it can be wrapped in an <code class="docutils literal"><span class="pre">Optional&lt;T&gt;</span></code>, but the
inner value can still be constrained with the <code class="docutils literal"><span class="pre">&#64;UnwrapValidatedValue</span></code> annotation. If the
<code class="docutils literal"><span class="pre">Optional</span></code> is absent, then the constraints are not applied.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Be careful when using constraints with <code class="docutils literal"><span class="pre">*Param</span></code> annotations on <code class="docutils literal"><span class="pre">Optional&lt;String&gt;</span></code> parameters
as there is a subtle, but important distinction between null and empty. If a client requests
<code class="docutils literal"><span class="pre">bar?q=</span></code>, <code class="docutils literal"><span class="pre">q</span></code> will evaluate to <code class="docutils literal"><span class="pre">Optional.of(&quot;&quot;)</span></code>. If you want <code class="docutils literal"><span class="pre">q</span></code> to evaluate to
<code class="docutils literal"><span class="pre">Optional.absent()</span></code> in this situation, change the type to <code class="docutils literal"><span class="pre">NonEmptyStringParam</span></code></p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Param types such as <code class="docutils literal"><span class="pre">IntParam</span></code> and <code class="docutils literal"><span class="pre">NonEmptyStringParam</span></code> can also be constrained.</p>
</div>
<p>There is a caveat regarding <code class="docutils literal"><span class="pre">&#64;UnwrapValidatedValue</span></code> and <code class="docutils literal"><span class="pre">*Param</span></code> types, as there still are some
cumbersome situations when constraints need to be applied to the container and the value.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@POST</span>
<span class="c1">// The @NotNull is supposed to mean that the parameter is required but the Max(3) is supposed to</span>
<span class="c1">// apply to the contained integer. Currently, this code will fail saying that Max can&#39;t</span>
<span class="c1">// be applied on an IntParam</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">createNum</span><span class="o">(</span><span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;num&quot;</span><span class="o">)</span> <span class="nd">@UnwrapValidatedValue</span><span class="o">(</span><span class="kc">false</span><span class="o">)</span>
                              <span class="nd">@NotNull</span> <span class="nd">@Max</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="n">IntParam</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@GET</span>
<span class="c1">// Similarly, the underlying validation framework can&#39;t unwrap nested types (an integer wrapped</span>
<span class="c1">// in an IntParam wrapped in an Optional), regardless if the @UnwrapValidatedValue is used</span>
<span class="kd">public</span> <span class="n">Person</span> <span class="nf">retrieve</span><span class="o">(</span><span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;num&quot;</span><span class="o">)</span> <span class="nd">@Max</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">IntParam</span><span class="o">&gt;</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To work around these limitations, if the parameter is required check for it in the endpoint and
throw an exception, else use <code class="docutils literal"><span class="pre">&#64;DefaultValue</span></code> or move the <code class="docutils literal"><span class="pre">Optional</span></code> into the endpoint.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@POST</span>
<span class="c1">// Workaround to handle required int params and validations</span>
<span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Person</span><span class="o">&gt;</span> <span class="nf">createNum</span><span class="o">(</span><span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;num&quot;</span><span class="o">)</span> <span class="nd">@Max</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="n">IntParam</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">num</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">throw</span> <span class="k">new</span> <span class="n">WebApplicationException</span><span class="o">(</span><span class="s">&quot;query param num must not be null&quot;</span><span class="o">,</span> <span class="mi">400</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@GET</span>
<span class="c1">// Workaround to handle optional int params and validations with DefaultValue</span>
<span class="kd">public</span> <span class="n">Person</span> <span class="nf">retrieve</span><span class="o">(</span><span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;num&quot;</span><span class="o">)</span> <span class="nd">@DefaultValue</span><span class="o">(</span><span class="s">&quot;0&quot;</span><span class="o">)</span> <span class="nd">@Max</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="n">IntParam</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// ...</span>
<span class="o">}</span>

<span class="nd">@GET</span>
<span class="c1">// Workaround to handle optional int params and validations with Optional</span>
<span class="kd">public</span> <span class="n">Person</span> <span class="nf">retrieve2</span><span class="o">(</span><span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;num&quot;</span><span class="o">)</span> <span class="nd">@Max</span><span class="o">(</span><span class="mi">3</span><span class="o">)</span> <span class="n">IntParam</span> <span class="n">num</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">Optional</span><span class="o">.</span><span class="na">fromNullable</span><span class="o">(</span><span class="n">num</span><span class="o">);</span>
    <span class="c1">// ...</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="enum-constraints">
<span id="man-validation-validations-enum-constraints"></span><h3>Enum Constraints</h3>
<p>Given the following enum:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">enum</span> <span class="n">Choice</span> <span class="o">{</span>
    <span class="n">OptionA</span><span class="o">,</span>
    <span class="n">OptionB</span><span class="o">,</span>
    <span class="n">OptionC</span>
<span class="o">}</span>
</pre></div>
</div>
<p>And the endpoint:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@GET</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getEnum</span><span class="o">(</span><span class="nd">@NotNull</span> <span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;choice&quot;</span><span class="o">)</span> <span class="n">Choice</span> <span class="n">choice</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">choice</span><span class="o">.</span><span class="na">toString</span><span class="o">();</span>
<span class="o">}</span>
</pre></div>
</div>
<p>One can expect Dropwizard not only to ensure that the query parameter exists, but to also provide
the client a list of valid options <code class="docutils literal"><span class="pre">query</span> <span class="pre">param</span> <span class="pre">choice</span> <span class="pre">must</span> <span class="pre">be</span> <span class="pre">one</span> <span class="pre">of</span> <span class="pre">[OptionA,</span> <span class="pre">OptionB,</span> <span class="pre">OptionC]</span></code>
when an invalid parameter is provided. The enum that the query parameter is deserialized into is
first attempted on the enum’s <code class="docutils literal"><span class="pre">name()</span></code> field and then <code class="docutils literal"><span class="pre">toString()</span></code>. During the case insensitive
comparisons, the query parameter has whitespace removed with dashes and dots normalized to
underscores. This logic is also used when deserializing request body’s that contain enums.</p>
</div>
<div class="section" id="return-value-validations">
<span id="man-validation-validations-return-value-validations"></span><h3>Return Value Validations</h3>
<p>It’s reasonable to want to make guarantees to clients regarding the server response. For example,
you may want to assert that no response will ever be <code class="docutils literal"><span class="pre">null</span></code>, and if an endpoint creates a
<code class="docutils literal"><span class="pre">Person</span></code> that the person is valid.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@POST</span>
<span class="nd">@NotNull</span>
<span class="nd">@Valid</span>
<span class="kd">public</span> <span class="n">Person</span> <span class="nf">create</span><span class="o">()</span> <span class="o">{</span>
    <span class="k">return</span> <span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="kc">null</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
<p>In this instance, instead of returning someone with a null name, Dropwizard will return an <code class="docutils literal"><span class="pre">HTTP</span>
<span class="pre">500</span> <span class="pre">Internal</span> <span class="pre">Server</span> <span class="pre">Error</span></code> with the error <code class="docutils literal"><span class="pre">server</span> <span class="pre">response</span> <span class="pre">name</span> <span class="pre">may</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">empty</span></code>, so the client
knows the server failed through no fault of their own.</p>
<p>Analogous to an empty request body, an empty entity annotated with <code class="docutils literal"><span class="pre">&#64;NotNull</span></code> will return <code class="docutils literal"><span class="pre">server</span>
<span class="pre">response</span> <span class="pre">may</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">null</span></code></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p>Be careful when using return value constraints when endpoints satisfy all of the following:</p>
<ul class="simple">
<li>Function name starts with <code class="docutils literal"><span class="pre">get</span></code></li>
<li>No arguments</li>
<li>The return value has validation constraints</li>
</ul>
<p>If an endpoint satisfies these conditions, whenever a request is processed by the resource that
endpoint will be additionally invoked. To give a concrete example:</p>
<blockquote class="last">
<div><div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/&quot;</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ValidatedResource</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">AtomicLong</span> <span class="n">counter</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AtomicLong</span><span class="o">();</span>

    <span class="nd">@GET</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/foo&quot;</span><span class="o">)</span>
    <span class="nd">@NotEmpty</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getFoo</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">counter</span><span class="o">.</span><span class="na">getAndIncrement</span><span class="o">();</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@GET</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/bar&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBar</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>If a <code class="docutils literal"><span class="pre">/foo</span></code> is requested then <code class="docutils literal"><span class="pre">counter</span></code> will have increment by 2, and if <code class="docutils literal"><span class="pre">/bar</span></code> is
requested then <code class="docutils literal"><span class="pre">counter</span></code> will increment by 1. It is our hope that such endpoints are few, far
between, and documented thoroughly.</p>
</div></blockquote>
</div>
</div>
</div>
<div class="section" id="limitations">
<span id="man-validation-limitations"></span><h2>Limitations</h2>
<p>Jersey allows for <code class="docutils literal"><span class="pre">BeanParam</span></code> to have setters with <code class="docutils literal"><span class="pre">*Param</span></code> annotations. While nice for simple
transformations it does obstruct validation, so clients won’t receive as instructive of error
messages. The following example shows the behavior:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/root&quot;</span><span class="o">)</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Resource</span> <span class="o">{</span>

    <span class="nd">@GET</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;params&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getBean</span><span class="o">(</span><span class="nd">@Valid</span> <span class="nd">@BeanParam</span> <span class="n">MyBeanParams</span> <span class="n">params</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">params</span><span class="o">.</span><span class="na">getField</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyBeanParams</span> <span class="o">{</span>
        <span class="nd">@NotEmpty</span>
        <span class="kd">private</span> <span class="n">String</span> <span class="n">field</span><span class="o">;</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="nf">getField</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="n">field</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nd">@QueryParam</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span>
        <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setField</span><span class="o">(</span><span class="n">String</span> <span class="n">field</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">field</span> <span class="o">=</span> <span class="n">Strings</span><span class="o">.</span><span class="na">nullToEmpty</span><span class="o">(</span><span class="n">field</span><span class="o">).</span><span class="na">trim</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>A client submitting the query parameter <code class="docutils literal"><span class="pre">foo</span></code> as blank will receive the following error message:</p>
<div class="highlight-json"><div class="highlight"><pre><span></span><span class="p">{</span><span class="nt">&quot;errors&quot;</span><span class="p">:[</span><span class="s2">&quot;getBean.arg0.field may not be empty&quot;</span><span class="p">]}</span>
</pre></div>
</div>
<p>Workarounds include:</p>
<ul class="simple">
<li>Name <code class="docutils literal"><span class="pre">BeanParam</span></code> fields the same as the <code class="docutils literal"><span class="pre">*Param</span></code> annotation values</li>
<li>Supply validation message on annotation: <code class="docutils literal"><span class="pre">&#64;NotEmpty(message</span> <span class="pre">=</span> <span class="pre">&quot;query</span> <span class="pre">param</span> <span class="pre">foo</span> <span class="pre">must</span> <span class="pre">not</span> <span class="pre">be</span> <span class="pre">empty&quot;)</span></code></li>
<li>Perform transformations and validations on <code class="docutils literal"><span class="pre">*Param</span></code> inside endpoint</li>
</ul>
<p>The same kind of limitation applies for <a class="reference internal" href="core.html#man-core-configuration"><span class="std std-ref">Configuration</span></a> objects:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyConfiguration</span> <span class="kd">extends</span> <span class="n">Configuration</span> <span class="o">{</span>
    <span class="nd">@NotNull</span>
    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;foo&quot;</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">baz</span><span class="o">;</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Even though the property’s name is <code class="docutils literal"><span class="pre">foo</span></code>, the error when property is null will be:</p>
<div class="highlight-text"><div class="highlight"><pre><span></span>* baz may not be null
</pre></div>
</div>
</div>
<div class="section" id="annotations">
<h2>Annotations</h2>
<p>In addition to the <a class="reference external" href="https://docs.jboss.org/hibernate/validator/5.4/reference/en-US/html_single/#section-builtin-constraints">annotations defined in Hibernate Validator</a>, Dropwizard contains another set of annotations,
which are briefly shown below.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@NotEmpty</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@NotEmpty</span>
    <span class="nd">@OneOf</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="o">{</span><span class="s">&quot;m&quot;</span><span class="o">,</span> <span class="s">&quot;f&quot;</span><span class="o">},</span> <span class="n">ignoreCase</span> <span class="o">=</span> <span class="kc">true</span><span class="o">,</span> <span class="n">ignoreWhitespace</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="c1">// @OneOf forces a value to value within certain values.</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">gender</span><span class="o">;</span>

    <span class="nd">@Max</span><span class="o">(</span><span class="mi">10</span><span class="o">)</span>
    <span class="nd">@Min</span><span class="o">(</span><span class="mi">0</span><span class="o">)</span>
    <span class="c1">// The integer contained, if present, can attain a min value of 0 and a max of 10.</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="n">Optional</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">animals</span><span class="o">;</span>

    <span class="nd">@JsonCreator</span>
    <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="c1">// Method that must return true for the object to be valid</span>
    <span class="nd">@ValidationMethod</span><span class="o">(</span><span class="n">message</span><span class="o">=</span><span class="s">&quot;name may not be Coda&quot;</span><span class="o">)</span>
    <span class="nd">@JsonIgnore</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isNotCoda</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="o">!</span><span class="s">&quot;Coda&quot;</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>The reason why Dropwizard defines <code class="docutils literal"><span class="pre">&#64;ValidationMethod</span></code> is that more complex validations (for
example, cross-field comparisons) are often hard to do using declarative annotations. Adding
<code class="docutils literal"><span class="pre">&#64;ValidationMethod</span></code> to any <code class="docutils literal"><span class="pre">boolean</span></code>-returning method which begins with <code class="docutils literal"><span class="pre">is</span></code> is a short and
simple workaround:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Due to the rather daft JavaBeans conventions, when using <code class="docutils literal"><span class="pre">&#64;ValidationMethod</span></code>, the method must
begin with <code class="docutils literal"><span class="pre">is</span></code> (e.g., <code class="docutils literal"><span class="pre">#isValidPortRange()</span></code>. This is a limitation of Hibernate Validator,
not Dropwizard.</p>
</div>
<div class="section" id="validating-grouped-constraints-with-validated">
<span id="man-validation-annotations-validated"></span><h3>Validating Grouped Constraints with <code class="docutils literal"><span class="pre">&#64;Validated</span></code></h3>
<p>The <code class="docutils literal"><span class="pre">&#64;Validated</span></code> annotation allows for <a class="reference external" href="https://docs.jboss.org/hibernate/validator/5.4/reference/en-US/html_single/#chapter-groups">validation groups</a> to be specifically set, instead of the
default group. This is useful when different endpoints share the same entity but may have different
validation requirements.</p>
<p>Going back to our favorite <code class="docutils literal"><span class="pre">Person</span></code> class. Let’s say in the initial version of our API, <code class="docutils literal"><span class="pre">name</span></code>
has to be non-empty, but realized that business requirements changed and a name can’t be longer than
5 letters.  Instead of switching out the API from unsuspecting clients, we can accept both versions
of the API but at different endpoints.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="c1">// We&#39;re going to create a group of validations for each version of our API</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Version1Checks</span> <span class="o">{</span> <span class="o">}</span>

<span class="c1">// Our second version will extend Hibernate Validator Default class so that any validation</span>
<span class="c1">// annotation without an explicit group will also be validated with this version</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">Version2Checks</span> <span class="kd">extends</span> <span class="n">Default</span> <span class="o">{</span> <span class="o">}</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="nd">@NotEmpty</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="n">Version1Checks</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="mi">5</span><span class="o">,</span> <span class="n">groups</span> <span class="o">=</span> <span class="n">Version2Checks</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="nd">@JsonCreator</span>
    <span class="kd">public</span> <span class="nf">Person</span><span class="o">(</span><span class="nd">@JsonProperty</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">)</span> <span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@JsonProperty</span>
    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

<span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/person&quot;</span><span class="o">)</span>
<span class="nd">@Produces</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">APPLICATION_JSON</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PersonResource</span> <span class="o">{</span>

    <span class="c1">// For the v1 endpoint, we&#39;ll validate with the version1 class, so we&#39;ll need to change the</span>
    <span class="c1">// group of the NotNull annotation from the default of Default.class to Version1Checks.class</span>
    <span class="nd">@POST</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/v1&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createPersonV1</span><span class="o">(</span>
        <span class="nd">@NotNull</span><span class="o">(</span><span class="n">groups</span> <span class="o">=</span> <span class="n">Version1Checks</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="nd">@Valid</span>
        <span class="nd">@Validated</span><span class="o">(</span><span class="n">Version1Checks</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
        <span class="n">Person</span> <span class="n">person</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implementation ...</span>
    <span class="o">}</span>

    <span class="c1">// For the v2 endpoint, we&#39;ll validate with version1 and version2, which implicitly</span>
    <span class="c1">// adds in the Default.class.</span>
    <span class="nd">@POST</span>
    <span class="nd">@Path</span><span class="o">(</span><span class="s">&quot;/v2&quot;</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">createPersonV2</span><span class="o">(</span>
        <span class="nd">@NotNull</span>
        <span class="nd">@Valid</span>
        <span class="nd">@Validated</span><span class="o">({</span><span class="n">Version1Checks</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="n">Version2Checks</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>
        <span class="n">Person</span> <span class="n">person</span>
    <span class="o">)</span> <span class="o">{</span>
        <span class="c1">// implementation ...</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Now when clients hit <code class="docutils literal"><span class="pre">/person/v1</span></code> the <code class="docutils literal"><span class="pre">Person</span></code> entity will be checked by all the constraints
that are a part of the <code class="docutils literal"><span class="pre">Version1Checks</span></code> group. If <code class="docutils literal"><span class="pre">/person/v2</span></code> is hit, then all validations
are performed.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If the <cite>Version1Checks</cite> group wasn’t set for the <cite>&#64;NotNull</cite> annotation for the v1 endpoint, the
annotation would not have had any effect and a null pointer exception would have occurred when a
property of a person is accessed. Dropwizard tries to protect against this class of bug by
disallowing multiple <cite>&#64;Validated</cite> annotations on an endpoint that contain different groups.</p>
</div>
</div>
</div>
<div class="section" id="testing">
<span id="man-validation-testing"></span><h2>Testing</h2>
<p>It is critical to test the constraints so that you can ensure the assumptions about the data hold
and see what kinds of error messages clients will receive for bad input. The recommended way for
testing annotations is through <a class="reference internal" href="testing.html#man-testing-resources"><span class="std std-ref">Testing Resources</span></a>, as Dropwizard does
a bit of magic behind the scenes when a constraint violation occurs to set the response’s status
code and ensure that the error messages are user friendly.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Test</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">personNeedsAName</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// Tests what happens when a person with a null name is sent to</span>
    <span class="c1">// the endpoint.</span>
    <span class="kd">final</span> <span class="n">Response</span> <span class="n">post</span> <span class="o">=</span> <span class="n">resources</span><span class="o">.</span><span class="na">target</span><span class="o">(</span><span class="s">&quot;/person/v1&quot;</span><span class="o">).</span><span class="na">request</span><span class="o">()</span>
            <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="n">Entity</span><span class="o">.</span><span class="na">json</span><span class="o">(</span><span class="k">new</span> <span class="n">Person</span><span class="o">(</span><span class="kc">null</span><span class="o">)));</span>

    <span class="c1">// Clients will receive a 422 on bad request entity</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getStatus</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="mi">422</span><span class="o">);</span>

    <span class="c1">// Check to make sure that errors are correct and human readable</span>
    <span class="n">ValidationErrorMessage</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">post</span><span class="o">.</span><span class="na">readEntity</span><span class="o">(</span><span class="n">ValidationErrorMessage</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">msg</span><span class="o">.</span><span class="na">getErrors</span><span class="o">())</span>
            <span class="o">.</span><span class="na">containsOnly</span><span class="o">(</span><span class="s">&quot;name may not be empty&quot;</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>
</div>
</div>
<div class="section" id="extending">
<span id="man-validation-extending"></span><h2>Extending</h2>
<p>While Dropwizard provides good defaults for validation error messages, one can customize the
response through an <code class="docutils literal"><span class="pre">ExceptionMapper&lt;JerseyViolationException&gt;</span></code>:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="cm">/** Return a generic response depending on if it is a client or server error */</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MyJerseyViolationExceptionMapper</span> <span class="kd">implements</span> <span class="n">ExceptionMapper</span><span class="o">&lt;</span><span class="n">JerseyViolationException</span><span class="o">&gt;</span> <span class="o">{</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="n">Response</span> <span class="nf">toResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">JerseyViolationException</span> <span class="n">exception</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">final</span> <span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&lt;?&gt;&gt;</span> <span class="n">violations</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="na">getConstraintViolations</span><span class="o">();</span>
        <span class="kd">final</span> <span class="n">Invocable</span> <span class="n">invocable</span> <span class="o">=</span> <span class="n">exception</span><span class="o">.</span><span class="na">getInvocable</span><span class="o">();</span>
        <span class="kd">final</span> <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">ConstraintMessage</span><span class="o">.</span><span class="na">determineStatus</span><span class="o">(</span><span class="n">violations</span><span class="o">,</span> <span class="n">invocable</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">Response</span><span class="o">.</span><span class="na">status</span><span class="o">(</span><span class="n">status</span><span class="o">)</span>
                <span class="o">.</span><span class="na">type</span><span class="o">(</span><span class="n">MediaType</span><span class="o">.</span><span class="na">TEXT_PLAIN_TYPE</span><span class="o">)</span>
                <span class="o">.</span><span class="na">entity</span><span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">500</span> <span class="o">?</span> <span class="s">&quot;Server error&quot;</span> <span class="o">:</span> <span class="s">&quot;Client error&quot;</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></div>
</div>
<p>To register <code class="docutils literal"><span class="pre">MyJerseyViolationExceptionMapper</span></code> and have it override the default:</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">run</span><span class="o">(</span><span class="kd">final</span> <span class="n">MyConfiguration</span> <span class="n">conf</span><span class="o">,</span> <span class="kd">final</span> <span class="n">Environment</span> <span class="n">env</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">env</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">MyJerseyViolationExceptionMapper</span><span class="o">());</span>
    <span class="n">env</span><span class="o">.</span><span class="na">jersey</span><span class="o">().</span><span class="na">register</span><span class="o">(</span><span class="k">new</span> <span class="n">Resource</span><span class="o">());</span>
<span class="o">}</span>
</pre></div>
</div>
<p>Dropwizard calculates the validation error message through <code class="docutils literal"><span class="pre">ConstraintMessage.getMessage</span></code>.</p>
<p>If you need to validate entities outside of resource endpoints, the validator can be accessed in the
<code class="docutils literal"><span class="pre">Environment</span></code> when the application is first ran.</p>
<div class="highlight-java"><div class="highlight"><pre><span></span><span class="n">Validator</span> <span class="n">validator</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="na">getValidator</span><span class="o">();</span>
<span class="n">Set</span><span class="o">&lt;</span><span class="n">ConstraintViolation</span><span class="o">&gt;</span> <span class="n">errors</span> <span class="o">=</span> <span class="n">validator</span><span class="o">.</span><span class="na">validate</span><span class="o">(</span><span class="cm">/* instance of class */</span><span class="o">)</span>
</pre></div>
</div>
</div>
</div>


            </div>
        </div>
        <hr/>
        <footer>
            <p style="float: left">
            &copy; Copyright 2010-2013, Coda Hale, Yammer Inc., 2014-2017 Dropwizard Team.
            Created using <a href="http://sphinx.pocoo.org/">Sphinx</a>
            1.6.5.
            </p>
            <p style="float: right">Dropwizard v1.3.0</p>
        </footer>
    </div>
</body>
</html>


